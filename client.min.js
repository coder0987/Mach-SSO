let locked=!1,userNameToken;const VALID_OPENERS={"https://machtarok.com/":!0};function reqListener(){unlock(),403==this.status||429==this.status||400==this.status?(console.log("Login failed!"),setStatus("fail")):(userNameToken=document.getElementById("username").value+":"+this.response,localStorage.setItem("machsso",userNameToken),setStatus("success"))}function setStatus(to,reason){var ls=document.getElementById("login_status"),lsd=document.getElementById("login_status_div");switch(to){case"fail":lsd.classList.add("fail"),lsd.classList.remove("success"),ls.innerHTML=reason=reason||"Login Attempt Unsuccessful";break;case"success":lsd.classList.add("success"),lsd.classList.remove("fail"),ls.innerHTML="Success!";var redirect=new URLSearchParams(document.location.search).get("redirect");redirect&&VALID_OPENERS[redirect]?(ls.innerHTML+=" Redirecting...",window.opener.postMessage(userNameToken,redirect),window.close()):redirect&&console.log(redirect+" is not a valid opener");break;case"inform":lsd.classList.remove("fail"),lsd.classList.remove("success"),ls.innerHTML=reason;break;default:lsd.classList.remove("fail"),lsd.classList.remove("success"),ls.innerHTML=""}}function login(){if(!locked){var username=document.getElementById("username").value,password=document.getElementById("password").value;if(0==username.length||64<username.length||password.length<12||64<password.length)setStatus("fail","Username and password must be less than 64 characters long. Password must be at least 12 characters long.");else{let authString;try{if(/\s/.test(username))throw"Username contains whitespace";authString=btoa(username+":"+password)}catch(err){return void setStatus("fail","Invalid characters.")}lock();username=new XMLHttpRequest;username.addEventListener("load",reqListener),username.open("POST","/login",!0),username.setRequestHeader("Authorization","Basic "+authString),username.send()}}}function signup(){if(console.log("Sign up attempt..."),!locked){var username=document.getElementById("username").value,password=document.getElementById("password").value;if(password!=document.getElementById("passwordVerify").value)setStatus("fail","Password and Password Verification must match");else if(0==username.length||64<username.length||password.length<12||64<password.length)setStatus("fail","Username and password must be less than 64 characters long. Password must be at least 12 characters long.");else{let authString;try{if(/\s/.test(username))throw"Username contains whitespace";authString=btoa(username+":"+password)}catch(err){return void setStatus("fail","Invalid characters.")}lock();username=new XMLHttpRequest;username.addEventListener("load",reqListener),username.open("POST","/signup",!0),username.setRequestHeader("Authorization","Basic "+authString),username.send()}}}function lock(){locked=!0,setStatus("inform","loading")}function unlock(){locked=!1}function clearSaves(){localStorage.clear()}function signOut(){setStatus("inform","Signing out..."),document.getElementById("signOut").setAttribute("hidden","hidden");var redirect=new URLSearchParams(document.location.search).get("redirect");redirect&&VALID_OPENERS[redirect]?(window.opener.postMessage("signOut",redirect),window.close()):redirect&&console.log(redirect+" is not a valid opener")}function autoSignInCallback(){unlock(),200==this.status?setStatus("success"):(userNameToken="",clearSaves(),setStatus("fail","Auto Sign-In failed"))}"https:"!==location.protocol&&location.replace("https:${location.href.substring(location.protocol.length)}"),window.onload=()=>{var req;document.getElementById("signup").href+=document.location.search,document.getElementById("signOut").addEventListener("click",function(){clearSaves(),signOut()}),document.getElementById("form").addEventListener("submit",event=>(login(),event.preventDefault(),!1)),new URLSearchParams(document.location.search).get("signOut")&&(clearSaves(),signOut()),localStorage.getItem("machsso")&&(lock(),userNameToken=localStorage.getItem("machsso"),(req=new XMLHttpRequest).addEventListener("load",autoSignInCallback),req.open("POST","/verify",!0),req.setRequestHeader("Authorization",userNameToken),req.send(),document.getElementById("signOut").removeAttribute("hidden"))};